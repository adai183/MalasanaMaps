var map,place=[{name:"Cuervo Store",lat:40.426808,lng:-3.703256,description:"cool clothes and music. If you like garage Rock like Burger records",icon:"img/marker.svg",tag:"hardcoded",visible:!0},{name:"La Catrina - Mezcalería",lat:40.425271,lng:-3.702007,description:"Mezcal, good Mexican food in a colorful cantina full of Mexican folklore. The owner has good taste in music.",icon:"img/marker.svg",tag:"hardcoded",visible:!0},{name:"Federal Café",lat:40.427005,lng:-3.709271,description:"Good open workplace with creative breakfasts and Scandinavian design furniture",icon:"img/marker.svg",tag:"hardcoded",visible:!0},{name:"Mongo Scifi & Exotic Bar",lat:40.425136,lng:-3.704312,description:"Great place to party",icon:"img/marker.svg",tag:"hardcoded",visible:!0},{name:"Café Pepe Botella",lat:40.426588,lng:-3.703641,description:"Good coffee and jazz music",icon:"img/marker.svg",tag:"hardcoded",visible:!0}],Place=function(e){this.name=e.name,this.lat=e.lat,this.lng=e.lng,this.description=e.description,this.icon=e.icon,this.tag=e.tag,this.visible=e.visible},instagramCall=function(){$.ajax({type:"GET",dataType:"jsonp",data:!0,url:"https://api.instagram.com/v1/users/self/media/recent/?access_token=460702240.2045934.b1d27f475b81420ea53c8671507c7b3f",success:function(e){window.clearTimeout(t),console.log("instagram ",e);for(var t=0;t<e.data.length;t++){var a=e.data[t].location;console.log(a);var i={name:a.name,lat:a.latitude,lng:a.longitude,description:"<img class='img-responsive' style='width:300px; height: 300px;' src='"+e.data[t].images.standard_resolution.url+"''>",icon:"img/instagram-icon.svg",tag:"instagram",visible:!1};place.push(i)}clearTimeout(fallback),initMap()}})}(),initMap=function(){var e=function(){function e(e){e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},2500)}var t=this;this.placeList=ko.observableArray([]),this.igImages=ko.observableArray([]),this.search=ko.observable(""),t.showInstList=ko.observable(!1),t.hideInstList=ko.observable(!0),place.forEach(function(e){this.placeList.push(new Place(e))},this),this.currentPlace=ko.observable(this.placeList()[0]),this.setPlace=function(e){google.maps.event.trigger(e.marker,"click")},this.renderMarkers=function(e){for(var a=0,i=e.length;i>a;a++){var o={lat:e[a].lat,lng:e[a].lng},s=new google.maps.Marker({position:o,map:map,icon:e[a].icon,animation:google.maps.Animation.DROP,myPlace:e[a]});e[a].marker=s,e[a].visible===!1&&e[a].marker.setVisible(!1),t.createEventListener(e[a])}},this.createEventListener=function(a){a.marker.addListener("click",function(){e(a.marker),t.currentPlace(a),t.updateContent(a),t.infowindow&&t.infowindow.close(),t.infowindow.open(map,a.marker)})},this.filteredItems=ko.computed(function(){var e=t.search().toLowerCase();if(e&&""!==e)return ko.utils.arrayFilter(t.placeList(),function(t){return t.name.toLowerCase().indexOf(e)<0?t.marker.setVisible(!1):t.marker.setVisible(!0),-1!==t.name.toLowerCase().indexOf(e)});for(var a=0;a<t.placeList().length;a++)void 0!==t.placeList()[a].marker&&t.placeList()[a].marker.setVisible(!0);return t.placeList()});var a=[{featureType:"landscape.fill",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#e0efef"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{visibility:"on"},{hue:"#1900ff"},{color:"#c0e8e8"}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:100},{visibility:"on"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{visibility:"on"},{lightness:700}]},{featureType:"water",elementType:"all",stylers:[{color:"#7dcdcd"}]}];if(map=!0){var i=new google.maps.LatLng(40.426394,-3.704878);map=new google.maps.Map(document.getElementById("map"),{center:i,zoom:17,mapTypeControl:!1,scrollwheel:!1,styles:a,streetViewControl:!1})}else alert("Google Maps Error");this.infowindow=new google.maps.InfoWindow({maxWidth:300}),this.renderMarkers(t.placeList());var o=!1;t.toggleWeather=function(){if(o)$(".weather").hide(),$("#weather-button").text("show weather"),o=!1;else{var e,t="http://api.openweathermap.org/data/2.5/weather?lat=40.424430&lon=-3.701449&units=metric&appid=186b68b9f2c87ea71239b8d2dac0b380";$.getJSON(t,function(t){switch(e=t.weather[0].description){case"Sky is Clear":$(".sunny").show();break;case"few clouds":$(".sunny").show(),$(".cloudy").show();break;case"scattered clouds":$(".sunny").show(),$(".cloudy").show();break;case"broken clouds":$(".sunny").show(),$(".cloudy").show();break;case"overcast clouds":$(".cloudy").show();break;case"drizzle":$(".cloudy").show();break;case"rain":$(".rainy").show(),$(".cloudy").show();break;case"Thunderstorm":$(".rainy").show(),$(".cloudy").show(),$(".stormy").show();break;case"snow":$(".snowy").show(),$(".cloudy").show();break;case"mist":$(".cloudy").show();break;default:console.log("Sorry, "+e+" does not match any coded weather description.")}$("#weather-button").text("hide weather"),o=!0}).fail(function(){alert("Weather API Error")})}},t.toggleWeather();var s=!0;t.toggleInstPosts=function(){if(s){t.hideInstList(!1),t.showInstList(!0);for(var e=0;e<t.placeList().length;e++)t.placeList()[e].marker.setVisible(!0);s=!1,$("#post-button").text("hide posts")}else{t.hideInstList(!0),t.showInstList(!1);for(var e=0;e<t.placeList().length;e++)"instagram"===t.placeList()[e].tag&&t.placeList()[e].marker.setVisible(!1);s=!0,$("#post-button").text("show posts")}}};e.prototype.updateContent=function(e){var t='<div id="content"><div id="siteNotice"></div><h4 id="firstHeading" class="firstHeading">'+e.name+'</h4><div id="bodyContent"><p>'+e.description+"</p></div></div>";this.infowindow.setContent(t)},ko.applyBindings(new e)},fallback=setTimeout(function(){initMap(),alert("Failed to get data from Instagram API")},8e3);